<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Front Desk Admin Panel</title>
    <link href="lib/css/bootstrap.min.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://www.nerdfonts.com/assets/css/webfont.css"
      rel="stylesheet"
    />
    <script src="lib/js/vue.global.js"></script>
    <script src="lib/js/axios.min.js"></script>
    <script src="lib/js/bootstrap.bundle.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <link rel="stylesheet" href="styles.css?v=2" />
    <style>
      /* --- FIX FOR VUE MANUAL MODALS (No Backdrop Element) --- */
      /* Since there is no .modal-backdrop div, we dim the .modal container itself */
      #app .modal.show {
        background-color: rgba(0, 0, 0, 0.35) !important; /* Subtle Frost */
        -webkit-backdrop-filter: blur(8px) !important;
        backdrop-filter: blur(8px) !important;
      }
    </style>
  </head>
  <body>
    <div
      id="app"
      class="container-fluid"
      :class="{ 'fab-clearance': activeTab === 'clients' }"
    >
      <nav
        class="navbar navbar-expand-lg navbar-dark bg-primary mb-4"
        v-if="currentView === 'dashboard'"
      >
        <div class="container-fluid">
          <a class="navbar-brand" href="#" style="font-size: 1em">
            <pre class="mb-0 ascii-logo">
‚ñë‚ñà‚ñÄ‚ñÄ‚ñë‚ñà‚ñÄ‚ñÑ‚ñë‚ñà‚ñÄ‚ñà‚ñë‚ñà‚ñÄ‚ñà‚ñë‚ñÄ‚ñà‚ñÄ‚ñë‚ñà‚ñÄ‚ñÑ‚ñë‚ñà‚ñÄ‚ñÄ‚ñë‚ñà‚ñÄ‚ñÄ‚ñë‚ñà‚ñë‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñÄ‚ñà‚ñë‚ñÄ‚ñà‚ñÄ
‚ñë‚ñà‚ñÄ‚ñÄ‚ñë‚ñà‚ñÄ‚ñÑ‚ñë‚ñà‚ñë‚ñà‚ñë‚ñà‚ñë‚ñà‚ñë‚ñë‚ñà‚ñë‚ñë‚ñà‚ñë‚ñà‚ñë‚ñà‚ñÄ‚ñÄ‚ñë‚ñÄ‚ñÄ‚ñà‚ñë‚ñà‚ñÄ‚ñÑ‚ñë‚ñÑ‚ñÑ‚ñÑ‚ñë‚ñà‚ñÄ‚ñà‚ñë‚ñë‚ñà‚ñë
‚ñë‚ñÄ‚ñë‚ñë‚ñë‚ñÄ‚ñë‚ñÄ‚ñë‚ñÄ‚ñÄ‚ñÄ‚ñë‚ñÄ‚ñë‚ñÄ‚ñë‚ñë‚ñÄ‚ñë‚ñë‚ñÄ‚ñÄ‚ñë‚ñë‚ñÄ‚ñÄ‚ñÄ‚ñë‚ñÄ‚ñÄ‚ñÄ‚ñë‚ñÄ‚ñë‚ñÄ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñë‚ñÄ‚ñë‚ñÄ‚ñÄ‚ñÄ
</pre
            >
          </a>
          <div class="navbar-nav ms-auto">
            <div class="nav-item dropdown" v-if="currentUser">
              <button
                class="btn btn-outline-secondary btn-sm dropdown-toggle"
                type="button"
                id="userDropdown"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                {{ currentUser }}
              </button>
              <ul class="dropdown-menu" aria-labelledby="userDropdown">
                <li>
                  <span class="dropdown-item-text"
                    >Total Clients: {{ clients.length }}</span
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>

                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    @click.prevent="openAuditLog"
                  >
                    VIEW SYSTEM LOGS
                  </a>
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    @click.prevent="showSettingsModal = true"
                  >
                    Settings
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a
                    class="dropdown-item logout-item"
                    href="#"
                    @click.prevent="logout"
                  >
                    LOGOUT
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>

      <div
        v-if="currentView !== 'dashboard'"
        class="d-flex justify-content-center align-items-center"
        style="min-height: 80vh"
      >
        <div class="card p-4 shadow-lg" style="width: 400px">
          <div class="card-header text-center">
            <h5 class="mb-0">
              {{ currentView === 'login' ? 'Login' : 'Register' }} to Front Desk
              AI
            </h5>
          </div>
          <div class="card-body">
            <form
              @submit.prevent="currentView === 'login' ? login() : register()"
            >
              <div class="mb-3">
                <label for="authEmail" class="form-label">Email address</label>
                <input
                  type="email"
                  class="form-control"
                  id="authEmail"
                  v-model="authForm.email"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="authPassword" class="form-label">Password</label>
                <input
                  type="password"
                  class="form-control"
                  id="authPassword"
                  v-model="authForm.password"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary w-100 mb-2">
                {{ currentView === 'login' ? 'Login' : 'Register' }}
              </button>
              <p class="text-center mt-2">
                <a href="#" @click.prevent="toggleAuthView">
                  {{ currentView === 'login' ? 'Need an account? Register' :
                  'Already have an account? Login' }}
                </a>
              </p>
              <div v-if="authError" class="alert alert-danger mt-3">
                {{ authError }}
              </div>
            </form>
          </div>
        </div>
      </div>

      <div v-if="currentView === 'dashboard'" class="row">
        <div class="col-md-12">
          <!-- LIVE ACTIVITY PANEL -->
          <div v-if="activeCalls.length > 0" class="mb-4">
            <div
              class="card border-info"
              style="
                background: rgba(125, 207, 255, 0.05) !important;
                border-style: dashed !important;
              "
            >
              <div
                class="card-body d-flex align-items-center justify-content-between p-3"
              >
                <div class="d-flex align-items-center gap-3">
                  <div
                    class="spinner-grow text-info"
                    role="status"
                    style="width: 1rem; height: 1rem"
                  ></div>
                  <div>
                    <h6 class="text-info mb-0" style="letter-spacing: 2px">
                      ACTIVE AGENT SESSIONS
                    </h6>
                    <small class="text-muted"
                      >Real-time voice transmissions in progress</small
                    >
                  </div>
                </div>
                <div class="d-flex gap-3">
                  <div
                    v-for="call in activeCalls"
                    :key="call.call_id"
                    class="d-flex align-items-center gap-3 px-3 py-2 border border-info rounded bg-dark"
                  >
                    <i class="bi bi-mic-fill text-info"></i>
                    <div>
                      <div class="text-white fw-bold small">
                        {{ call.client_name }}
                      </div>
                      <div
                        class="text-muted small font-monospace"
                        style="font-size: 0.7rem"
                      >
                        {{ call.caller_phone }}
                      </div>
                    </div>
                    <div class="vr mx-2 text-secondary"></div>
                    <div class="font-monospace text-info fw-bold">
                      {{ formatDuration(calculateDuration(call.start_time)) }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ul class="nav nav-tabs mb-4 align-items-end">
            <li class="nav-item">
              <a
                class="nav-link"
                :class="{ active: activeTab === 'clients' }"
                href="#"
                @click.prevent="activeTab = 'clients'"
                >Clients</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                :class="{ active: activeTab === 'contacts' }"
                href="#"
                @click.prevent="activeTab = 'contacts'"
                >Contacts</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                :class="{ active: activeTab === 'logs' }"
                href="#"
                @click.prevent="activeTab = 'logs'"
                >Call Logs</a
              >
            </li>

            <li class="ms-5 pb-1" v-if="activeTab === 'clients'">
              <button
                v-if="clients.length > 0"
                @click="toggleBulkSelect"
                class="btn btn-sm btn-outline-secondary me-2"
              >
                {{ allSelected ? 'DESELECT ALL' : 'SELECT ALL' }} ({{
                selectedClients.length }})
              </button>
              <button
                v-if="selectedClients.length > 0"
                @click="bulkDuplicateClients"
                class="btn btn-sm btn-outline-info me-4"
              >
                DUPLICATE ({{ selectedClients.length }})
              </button>
              <button
                v-if="selectedClients.length > 0"
                @click="bulkDeleteClients"
                class="btn btn-sm btn-outline-danger"
              >
                DELETE ({{ selectedClients.length }})
              </button>
            </li>
            <li class="ms-5 pb-1" v-if="activeTab === 'contacts'">
              <button
                v-if="contacts.length > 0"
                @click="toggleSelectAllContacts"
                class="btn btn-sm btn-outline-secondary me-4"
              >
                {{ allContactsSelected ? 'DESELECT ALL' : 'SELECT ALL' }} ({{
                selectedContacts.length }})
              </button>
              <button
                v-if="selectedContacts.length > 0"
                @click="bulkDeleteContacts"
                class="btn btn-sm btn-outline-danger"
              >
                DELETE ({{ selectedContacts.length }})
              </button>
            </li>

            <li class="ms-5 pb-1" v-if="activeTab === 'logs'">
              <button
                v-if="filteredCallLogs.length > 0"
                @click="toggleSelectAllCallLogs"
                class="btn btn-sm btn-outline-secondary me-4"
              >
                {{ selectAllCallLogs ? 'DESELECT ALL' : 'SELECT ALL' }} ({{
                selectedCallLogs.length }})
              </button>
              <button
                v-if="selectedCallLogs.length > 0"
                @click="deleteCallLogs"
                class="btn btn-sm btn-outline-danger"
              >
                DELETE ({{ selectedCallLogs.length }})
              </button>
            </li>
          </ul>
          <div v-if="activeTab === 'clients'">
            <div class="row mb-3">
              <div class="col-md-6">
                <input
                  v-model="searchQuery"
                  @input="filterClients"
                  type="search"
                  class="form-control"
                  placeholder="Search clients..."
                />
              </div>
              <div class="col-md-3">
                <select
                  v-model="filterStatus"
                  @change="filterClients"
                  class="form-select"
                >
                  <option value="">All Status</option>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>
              <div class="col-md-3">
                <select
                  v-model="sortBy"
                  @change="sortClients"
                  class="form-select"
                >
                  <option value="name">Sort by Name</option>
                  <option value="created_at">Sort by Created</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div
                v-for="client in filteredClients"
                :key="client.id"
                class="col-md-6 col-lg-4 mb-4"
              >
                <div
                  class="card client-card h-100"
                  @click="toggleClientSelection(client.id)"
                  :class="{ 'selected-card': selectedClients.includes(client.id) }"
                >
                  <div
                    class="card-header d-flex justify-content-between align-items-center"
                  >
                    <div class="d-flex align-items-center gap-2">
                      <h5 class="card-title mb-0">
                        {{ formatName(client.name) }}
                      </h5>
                    </div>
                    <button
                      @click.stop="editClient(client)"
                      class="btn btn-sm btn-outline-secondary border-0 p-0 ms-1"
                      title="Edit"
                      style="color: var(--theme-comment)"
                    >
                      <i class="nf nf-fa-pen_to_square"></i>
                    </button>
                  </div>
                  <div class="card-body d-flex flex-column gap-3">
                    <!-- Hyprland Layout: Flex Row -->
                    <div
                      class="d-flex justify-content-between align-items-start"
                    >
                      <!-- Left: Contact Info -->
                      <div class="d-flex flex-column gap-2">
                        <div class="spec-row mb-0" title="Contact Number">
                          <i class="nf nf-fa-phone spec-icon"></i>
                          <span class="spec-value tech-font"
                            >{{ client.cell || 'NO NUMBER' }}</span
                          >
                        </div>

                        <div class="spec-row mb-0" title="Business Hours">
                          <i class="nf nf-fa-clock_o spec-icon"></i>
                          <span class="spec-value">
                            {{ formatHour(client.business_start_hour) }} - {{
                            formatHour(client.business_end_hour) }}
                          </span>
                        </div>

                        <div
                          v-if="hasScheduling(client)"
                          class="spec-row mb-0"
                          title="Calendar ID"
                        >
                          <i class="nf nf-fa-calendar_check_o spec-icon"></i>
                          <span class="spec-value">
                            {{ client.calendar_id ?
                            truncateId(client.calendar_id) : '‚ö†Ô∏è MISSING ID' }}
                          </span>
                        </div>

                        <div class="spec-row mb-0" title="Created Date">
                          <i class="nf nf-fa-calendar_plus_o spec-icon"></i>
                          <span class="spec-value small">
                            {{ formatDate(client.created_at) }}
                          </span>
                        </div>
                      </div>

                      <!-- Right: Badges (Stacked) -->
                      <div class="d-flex flex-column gap-2 align-items-end">
                        <!-- Tech Stack Badges -->
                        <div
                          class="d-flex gap-1 justify-content-end flex-wrap"
                          style="max-width: 150px"
                        >
                          <span class="sst-badge" title="STT Model">
                            <i class="nf nf-fa-microphone"></i>
                            {{ formatSttModel(client.stt_model) }}
                          </span>
                          <span class="model-badge" title="LLM Model">
                            <i class="nf nf-fa-robot"></i>
                            {{ client.llm_model.split('/')[1] ||
                            client.llm_model }}
                          </span>
                          <span class="voice-badge" title="TTS Voice">
                            <i class="nf nf-md-waveform"></i>
                            {{ getVoiceName(client.tts_voice_id) }}
                          </span>
                        </div>

                        <!-- Tool Badges (Pills) -->
                        <div class="d-flex gap-1 justify-content-end flex-wrap">
                          <span
                            class="tool-badge"
                            :class="{ 'disabled': !hasScheduling(client) }"
                            title="Scheduling"
                          >
                            <i class="nf nf-md-calendar_range"></i>
                          </span>
                          <span
                            class="tool-badge"
                            :class="{ 'disabled': !hasMemory(client) }"
                            title="Memory"
                          >
                            <i class="nf nf-fa-brain"></i>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    class="card-footer d-flex justify-content-between align-items-center"
                  >
                    <!-- PENDING PROVISIONING STATE -->
                    <div
                      v-if="!client.cell"
                      class="d-flex align-items-center gap-2 w-100 justify-content-center"
                    >
                      <button
                        @click.stop="openProvisionModal(client)"
                        class="btn btn-sm btn-primary fw-bold w-100"
                        style="box-shadow: 0 0 10px rgba(13, 110, 253, 0.5)"
                      >
                        üì¢ CLAIM NUMBER
                      </button>
                    </div>

                    <!-- ACTIVE STATE -->
                    <div
                      v-else
                      class="d-flex align-items-center justify-content-between w-100"
                    >
                      <span
                        class="fuel-gauge clickable-fuel"
                        :class="(client.balance_seconds || 0) < 60 ? 'fuel-low' : 'fuel-cyan'"
                        @click.stop="openTopUpModal(client)"
                        title="Click to Add Funds"
                        style="cursor: pointer"
                      >
                        <i class="nf nf-fa-hourglass_half me-1"></i>
                        {{ formatDuration(client.balance_seconds || 0) }}
                      </span>

                      <div class="d-flex gap-2">
                        <button
                          @click.stop="openSimulator(client)"
                          class="btn btn-sm btn-outline-secondary border-0"
                          title="Launch Simulator"
                        >
                          <i class="nf nf-fa-headset"></i>
                        </button>

                        <button
                          @click.stop="toggleClientStatus(client)"
                          class="btn btn-sm status-toggle-btn"
                          :class="client.is_active ? 'btn-outline-success' : 'btn-outline-danger'"
                          :title="client.is_active ? 'Disable Client' : 'Enable Client'"
                        >
                          <span class="status-icon"
                            >{{ client.is_active ? '‚óè' : '‚óã' }}</span
                          >
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <nav v-if="totalPages > 1" aria-label="Client pagination">
              <ul class="pagination justify-content-center">
                <li class="page-item" :class="{ disabled: currentPage === 1 }">
                  <a
                    class="page-link"
                    href="#"
                    @click.prevent="currentPage--"
                    v-if="currentPage > 1"
                    >Previous</a
                  >
                </li>
                <li
                  v-for="page in visiblePages"
                  :key="page"
                  class="page-item"
                  :class="{ active: page === currentPage }"
                >
                  <a
                    class="page-link"
                    href="#"
                    @click.prevent="currentPage = page"
                    >{{ page }}</a
                  >
                </li>
                <li
                  class="page-item"
                  :class="{ disabled: currentPage === totalPages }"
                >
                  <a
                    class="page-link"
                    href="#"
                    @click.prevent="currentPage++"
                    v-if="currentPage < totalPages"
                    >Next</a
                  >
                </li>
              </ul>
            </nav>
          </div>

          <!-- Subscription Modal -->
          <div
            class="modal fade"
            :class="{ show: showSubscriptionModal }"
            :style="{ display: showSubscriptionModal ? 'block' : 'none' }"
            tabindex="-1"
          >
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div
                  class="modal-header border-bottom border-secondary border-opacity-25"
                >
                  <h5 class="modal-title text-warning">
                    <i class="bi bi-gem me-2"></i>Select Your AI Agent Plan
                  </h5>
                  <button
                    type="button"
                    class="btn-close btn-close-white"
                    @click="cancelSubscription"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body p-4">
                  <p class="text-center text-muted mb-4">
                    Subscribe to activate your agent and provision a phone
                    number.
                  </p>
                  <div class="row g-4">
                    <!-- Starter -->
                    <div class="col-md-4">
                      <div
                        class="card h-100 border-secondary border-opacity-25 bg-dark"
                      >
                        <div
                          class="card-header text-center bg-transparent border-0 pt-4"
                        >
                          <h5 class="text-muted">STARTER</h5>
                          <h2 class="display-6 fw-bold text-fg">
                            $20<span class="fs-6 text-muted">/mo</span>
                          </h2>
                          <span class="text-muted small">100 Minutes</span>
                        </div>
                        <div class="card-footer bg-transparent border-0 pb-4">
                          <button
                            @click="selectSubscription('starter')"
                            class="btn btn-outline-secondary w-100"
                          >
                            Subscribe
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Growth -->
                    <div class="col-md-4">
                      <div
                        class="card h-100 border-success border-opacity-50"
                        style="background: rgba(25, 135, 84, 0.1)"
                      >
                        <div
                          class="card-header text-center bg-transparent border-0 pt-4"
                        >
                          <h5 class="text-success">GROWTH</h5>
                          <h2 class="display-6 fw-bold text-white">
                            $50<span class="fs-6 text-white-50">/mo</span>
                          </h2>
                          <span class="text-success small fw-bold"
                            >300 Minutes</span
                          >
                        </div>
                        <div class="card-footer bg-transparent border-0 pb-4">
                          <button
                            @click="selectSubscription('growth')"
                            class="btn btn-success w-100"
                          >
                            Subscribe
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Power -->
                    <div class="col-md-4">
                      <div
                        class="card h-100 border-warning border-opacity-50 bg-dark position-relative overflow-hidden"
                      >
                        <div
                          class="position-absolute top-0 end-0 bg-warning text-dark px-3 py-1 small fw-bold"
                          style="border-bottom-left-radius: 8px"
                        >
                          BEST VALUE
                        </div>
                        <div
                          class="card-header text-center bg-transparent border-0 pt-4"
                        >
                          <h5 class="text-warning">POWER</h5>
                          <h2 class="display-6 fw-bold text-fg">
                            $100<span class="fs-6 text-muted">/mo</span>
                          </h2>
                          <span class="text-warning small fw-bold"
                            >600 Minutes</span
                          >
                        </div>
                        <div class="card-footer bg-transparent border-0 pb-4">
                          <button
                            @click="selectSubscription('power')"
                            class="btn btn-outline-warning w-100"
                          >
                            Subscribe
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Provisioning Modal -->
          <div
            class="modal fade"
            :class="{ show: showProvisionModal }"
            :style="{ display: showProvisionModal ? 'block' : 'none' }"
            tabindex="-1"
          >
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Claim Phone Number</h5>
                  <button
                    type="button"
                    class="btn-close"
                    @click="closeProvisionModal"
                  ></button>
                </div>
                <div class="modal-body">
                  <div v-if="provisioningClient">
                    <p class="text-muted">
                      Select a phone number for
                      <strong>{{ provisioningClient.name }}</strong>.
                    </p>

                    <div class="input-group mb-3">
                      <input
                        v-model="searchAreaCode"
                        type="text"
                        class="form-control"
                        placeholder="Area Code (e.g. 415)"
                        maxlength="3"
                        @keyup.enter="searchNumbers"
                      />
                      <button
                        @click.prevent="searchNumbers"
                        class="btn btn-outline-primary"
                        type="button"
                        :disabled="searchingNumbers || !searchAreaCode"
                      >
                        <span
                          v-if="searchingNumbers"
                          class="spinner-border spinner-border-sm"
                          role="status"
                          aria-hidden="true"
                        ></span>
                        <span v-else>Search</span>
                      </button>
                    </div>

                    <div v-if="availableNumbers.length > 0" class="list-group">
                      <button
                        v-for="num in availableNumbers"
                        :key="num"
                        @click="confirmNumber(provisioningClient, num)"
                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                      >
                        {{ num }}
                        <span class="badge bg-primary rounded-pill">Claim</span>
                      </button>
                    </div>

                    <div
                      v-else-if="!searchingNumbers && searchAreaCode && availableNumbers.length === 0"
                      class="text-muted text-center"
                    >
                      No numbers found. Try a different area code.
                    </div>
                    <div v-else class="text-muted text-center small">
                      Enter an area code to search available Twilio numbers.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Simulator Modal -->
          <div
            class="modal fade"
            id="simulatorModal"
            tabindex="-1"
            aria-hidden="true"
          >
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content bg-dark border-secondary shadow-lg">
                <div
                  class="modal-header border-bottom border-secondary border-opacity-25"
                >
                  <h5 class="modal-title text-success font-monospace">
                    <i class="bi bi-terminal-fill me-2"></i>AGENT SIMULATOR
                  </h5>
                  <button
                    type="button"
                    class="btn-close btn-close-white"
                    @click="stopSimulation"
                  ></button>
                </div>
                <div class="modal-body text-center py-5">
                  <div v-if="simulatingClient">
                    <h4 class="text-fg mb-4">{{ simulatingClient.name }}</h4>

                    <div class="simulator-status mb-5">
                      <div class="status-circle-container mb-3">
                        <div
                          class="status-circle"
                          :class="{'active': isSimulating}"
                        ></div>
                      </div>
                      <div
                        class="font-monospace small text-uppercase"
                        :class="isSimulating ? 'text-success' : 'text-muted'"
                      >
                        {{ isSimulating ? 'LINK ACTIVE // TRANSMITTING' :
                        'DISCONNECTED' }}
                      </div>
                    </div>

                    <div class="d-grid gap-2 col-8 mx-auto">
                      <button
                        v-if="!isSimulating"
                        @click="startSimulation"
                        class="btn btn-success btn-lg font-monospace"
                      >
                        <i class="bi bi-power me-2"></i>INITIALIZE LINK
                      </button>
                      <button
                        v-else
                        @click="stopSimulation"
                        class="btn btn-danger btn-lg font-monospace"
                      >
                        <i class="bi bi-stop-circle me-2"></i>TERMINATE LINK
                      </button>
                    </div>

                    <div class="mt-4 text-muted small font-monospace">
                      <i class="bi bi-info-circle me-1"></i>
                      Usage is billed to client balance.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div v-if="activeTab === 'contacts'" class="contacts-tab">
            <div class="row mb-3">
              <div class="col-md-4">
                <input
                  v-model="contactSearchQuery"
                  type="search"
                  class="form-control"
                  placeholder="Search contacts..."
                />
              </div>

              <div class="col-md-3">
                <select v-model="contactFilterClient" class="form-select">
                  <option value="">All Clients</option>
                  <option
                    v-for="client in clients"
                    :key="client.id"
                    :value="client.id"
                  >
                    {{ client.name }}
                  </option>
                </select>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-custom">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Phone Number</th>
                    <th>Client</th>
                    <th>Last Contact</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-if="isLoading">
                    <td colspan="5" class="text-center p-5">
                      <div
                        class="h5 text-success"
                        style="
                          letter-spacing: 2px;
                          animation: pulse 1s infinite;
                        "
                      >
                        &gt;&gt; ACCESSING DATABASE...
                      </div>
                    </td>
                  </tr>
                  <tr
                    v-else
                    v-for="contact in filteredContacts"
                    :key="contact.phone"
                    @click="toggleContactSelection(contact.phone)"
                    :class="{ 'selected': selectedContacts.includes(contact.phone) }"
                    style="cursor: pointer"
                  >
                    <td class="text-blue">
                      <span
                        v-if="editingContactPhone !== contact.phone"
                        class="fw-bold"
                        >{{ contact.name }}</span
                      >
                      <input
                        v-else
                        v-model="tempContactName"
                        class="table-inline-input text-blue"
                        @click.stop
                        @keyup.enter="saveInlineEdit(contact)"
                        @keyup.esc="cancelInlineEdit()"
                        autofocus
                      />
                    </td>

                    <td class="text-fg fw-bold" style="letter-spacing: 1px">
                      {{ contact.phone }}
                    </td>

                    <td
                      class="text-purple text-uppercase"
                      style="font-size: 0.85rem; letter-spacing: 0.5px"
                    >
                      {{ contact.client_name }}
                    </td>

                    <td class="text-fg small">
                      {{ formatDate(contact.last_contact) }}
                    </td>

                    <td>
                      <div
                        v-if="editingContactPhone !== contact.phone"
                        class="d-flex gap-2"
                      >
                        <button
                          @click.stop="startInlineEdit(contact)"
                          class="btn btn-sm btn-outline-primary border-0 p-1"
                          title="Edit Name"
                        >
                          <i
                            class="bi bi-pencil-square"
                            style="font-size: 1rem"
                          ></i>
                        </button>

                        <button
                          @click.stop="viewContactHistory(contact)"
                          class="btn btn-sm btn-outline-info border-0 p-1"
                          title="View History"
                        >
                          <i
                            class="bi bi-clock-history"
                            style="font-size: 1rem"
                          ></i>
                        </button>

                        <button
                          @click.stop="deleteContact(contact.phone)"
                          class="btn btn-sm btn-outline-danger border-0 p-1"
                          title="Delete Contact"
                        >
                          <i class="bi bi-trash" style="font-size: 1rem"></i>
                        </button>
                      </div>

                      <div v-else class="d-flex gap-2">
                        <button
                          @click.stop="saveInlineEdit(contact)"
                          class="btn btn-sm btn-outline-success py-0 px-2 d-flex align-items-center"
                          title="Save Changes"
                        >
                          <i
                            class="bi bi-check-lg"
                            style="font-size: 1.1rem"
                          ></i>
                        </button>

                        <button
                          @click.stop="cancelInlineEdit"
                          class="btn btn-sm btn-outline-secondary py-0 px-2 d-flex align-items-center"
                          title="Cancel"
                        >
                          <i class="bi bi-x" style="font-size: 1.1rem"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div v-if="activeTab === 'logs'" class="logs-tab">
            <!-- Expanded Transcript View -->
            <div
              v-if="transcriptExpanded && selectedTranscript"
              class="expanded-transcript"
            >
              <div class="card h-100">
                <div
                  class="card-header d-flex justify-content-between align-items-center bg-transparent border-bottom border-secondary border-opacity-25"
                >
                  <div class="d-flex align-items-center gap-3">
                    <h5
                      class="mb-0 text-muted text-uppercase"
                      style="letter-spacing: 2px"
                    >
                      <i class="bi bi-chat-text me-2"></i> Transcript
                    </h5>
                    <span
                      class="text-purple"
                      style="font-size: 0.9rem; letter-spacing: 1px"
                    >
                      {{ selectedTranscript.client_name }}
                      <span class="text-muted">/</span> {{
                      selectedTranscript.phone }}
                    </span>
                  </div>
                  <button
                    @click="toggleTranscriptExpansion"
                    class="btn btn-sm btn-outline-primary border-0 p-1"
                    title="Exit Full Screen"
                  >
                    <i
                      class="bi bi-fullscreen-exit"
                      style="font-size: 1.2rem"
                    ></i>
                  </button>
                </div>

                <div class="card-body p-0" style="overflow-y: hidden">
                  <div
                    class="conversation-transcript expanded h-100 p-3"
                    style="overflow-y: auto"
                  >
                    <template
                      v-for="(message, index) in selectedTranscript.transcript"
                      :key="index"
                    >
                      <div v-if="message.role === 'user'" class="message user">
                        <div
                          class="d-flex justify-content-between align-items-start"
                        >
                          <strong>Caller:</strong>
                          <small class="text-muted"
                            >{{ formatTimestamp(message.timestamp) }}</small
                          >
                        </div>
                        <p>{{ message.content }}</p>
                      </div>

                      <div
                        v-else-if="message.role === 'assistant' && message.content"
                        class="message assistant"
                      >
                        <div
                          class="d-flex justify-content-between align-items-start"
                        >
                          <strong>Assistant:</strong>
                          <small class="text-muted"
                            >{{ formatTimestamp(message.timestamp) }}</small
                          >
                        </div>
                        <p>{{ message.content }}</p>
                      </div>

                      <div
                        v-if="message.role === 'assistant' && message.tool_calls"
                        class="message tool msg-action"
                      >
                        <div
                          class="d-flex justify-content-between align-items-start"
                        >
                          <strong style="color: var(--theme-orange)"
                            >‚ö° System Action:</strong
                          >
                          <small class="text-muted"
                            >{{ formatTimestamp(message.timestamp) }}</small
                          >
                        </div>
                        <div
                          v-for="tool in message.tool_calls"
                          :key="tool.id"
                          class="mb-1"
                        >
                          <span class="text-warning"
                            >{{ tool.function.name }}</span
                          >
                          <span class="text-success"
                            >({{ tool.function.arguments }})</span
                          >
                        </div>
                      </div>

                      <div
                        v-else-if="message.role === 'tool'"
                        class="message tool msg-result"
                      >
                        <div
                          class="d-flex justify-content-between align-items-start"
                        >
                          <strong style="color: var(--theme-green)"
                            >‚úì Tool Result:</strong
                          >
                          <small class="text-muted"
                            >{{ formatTimestamp(message.timestamp) }}</small
                          >
                        </div>
                        <p style="white-space: pre-wrap">
                          {{ message.content }}
                        </p>
                      </div>
                    </template>

                    <div
                      v-if="!selectedTranscript.transcript || selectedTranscript.transcript.length === 0"
                      class="text-muted text-center mt-4"
                    >
                      No transcript available.
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Normal Logs View -->
            <div v-else class="logs-view">
              <div class="row mb-3">
                <div class="col-md-4">
                  <input
                    v-model="logSearchQuery"
                    type="search"
                    class="form-control"
                    placeholder="Search logs..."
                  />
                </div>
                <div class="col-md-3">
                  <select v-model="logFilterClient" class="form-select">
                    <option value="">All Clients</option>
                    <option
                      v-for="client in clients"
                      :key="client.id"
                      :value="client.id"
                    >
                      {{ client.name }}
                    </option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div :class="selectedTranscript ? 'col-md-6' : 'col-md-12'">
                  <div class="table-responsive">
                    <table class="table table-custom">
                      <thead>
                        <tr>
                          <th class="text-center" style="width: 60px"></th>
                          <th>Date/Time</th>
                          <th>Client</th>
                          <th>Contact</th>
                          <th>Duration</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr v-if="isLoading">
                          <td colspan="6" class="text-center p-5">
                            <div
                              class="h5 text-success"
                              style="
                                letter-spacing: 2px;
                                animation: pulse 1s infinite;
                              "
                            >
                              &gt;&gt; ACCESSING DATABASE...
                            </div>
                          </td>
                        </tr>
                        <tr
                          v-else
                          v-for="log in filteredCallLogs"
                          :key="log.id"
                          @click="selectTranscript(log)"
                          :class="{ 'selected': selectedTranscript?.id === log.id }"
                          style="cursor: pointer"
                        >
                          <td class="text-center" @click.stop>
                            <input
                              type="checkbox"
                              v-model="selectedCallLogs"
                              :value="log.id"
                              class="form-check-input"
                              title="Select this log"
                            />
                          </td>

                          <td
                            class="text-fg"
                            style="font-size: 0.9rem; letter-spacing: 0.5px"
                          >
                            {{ formatDate(log.timestamp) }}
                          </td>

                          <td
                            class="text-purple text-uppercase"
                            style="
                              font-size: 0.8rem;
                              letter-spacing: 0.5px;
                              font-weight: 600;
                            "
                          >
                            {{ log.client_name }}
                          </td>

                          <td @click.stop>
                            <a
                              href="#"
                              @click.prevent="jumpToContact(log.phone)"
                              class="text-decoration-none text-blue hover-underline fw-bold"
                              title="Jump to Contact History"
                            >
                              {{ formatName(getContactName(log.phone)) }}
                            </a>
                          </td>

                          <td
                            class="text-fg small"
                            style="font-family: &quot;JetBrains Mono&quot;"
                          >
                            {{ formatDuration(log.duration) }}
                          </td>

                          <td
                            class="text-success small fw-bold text-uppercase"
                            style="letter-spacing: 1px"
                          >
                            {{ log.status }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="col-md-6" v-if="selectedTranscript">
                  <div class="card">
                    <div
                      class="card-header d-flex justify-content-between align-items-center bg-transparent border-bottom border-secondary border-opacity-25"
                    >
                      <h6
                        class="mb-0 text-muted text-uppercase"
                        style="letter-spacing: 2px"
                      >
                        <i class="bi bi-chat-text me-2"></i> Transcript
                      </h6>

                      <div class="d-flex gap-2">
                        <button
                          @click="toggleTranscriptExpansion"
                          class="btn btn-sm btn-outline-primary border-0 p-1"
                          title="Expand View"
                        >
                          <i
                            class="bi bi-arrows-fullscreen"
                            style="font-size: 1rem"
                          ></i>
                        </button>
                        <button
                          @click="selectedTranscript = null"
                          class="btn btn-sm btn-outline-secondary border-0 p-1"
                          title="Close Transcript"
                        >
                          <i class="bi bi-x-lg" style="font-size: 1rem"></i>
                        </button>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="conversation-transcript">
                        <template
                          v-for="(message, index) in selectedTranscript.transcript"
                          :key="index"
                        >
                          <div
                            v-if="message.role === 'user'"
                            class="message user"
                          >
                            <div
                              class="d-flex justify-content-between align-items-start"
                            >
                              <strong>Caller:</strong>
                              <small class="text-muted"
                                >{{ formatTimestamp(message.timestamp) }}</small
                              >
                            </div>
                            <p>{{ message.content }}</p>
                          </div>

                          <div
                            v-else-if="message.role === 'assistant' && message.content"
                            class="message assistant"
                          >
                            <div
                              class="d-flex justify-content-between align-items-start"
                            >
                              <strong>Assistant:</strong>
                              <small class="text-muted"
                                >{{ formatTimestamp(message.timestamp) }}</small
                              >
                            </div>
                            <p>{{ message.content }}</p>
                          </div>

                          <div
                            v-if="message.role === 'assistant' && message.tool_calls"
                            class="message tool msg-action"
                          >
                            <div
                              class="d-flex justify-content-between align-items-start"
                            >
                              <strong style="color: var(--theme-orange)"
                                >‚ö° System Action:</strong
                              >
                              <small class="text-muted"
                                >{{ formatTimestamp(message.timestamp) }}</small
                              >
                            </div>
                            <div
                              v-for="tool in message.tool_calls"
                              :key="tool.id"
                              class="mb-1"
                            >
                              <span class="text-warning"
                                >{{ tool.function.name }}</span
                              >
                              <span class="text-success"
                                >({{ tool.function.arguments }})</span
                              >
                            </div>
                          </div>

                          <div
                            v-else-if="message.role === 'tool'"
                            class="message tool msg-result"
                          >
                            <div
                              class="d-flex justify-content-between align-items-start"
                            >
                              <strong style="color: var(--theme-green)"
                                >‚úì Tool Result:</strong
                              >
                              <small class="text-muted"
                                >{{ formatTimestamp(message.timestamp) }}</small
                              >
                            </div>
                            <p style="white-space: pre-wrap">
                              {{ message.content }}
                            </p>
                          </div>
                        </template>

                        <div
                          v-if="!selectedTranscript.transcript || selectedTranscript.transcript.length === 0"
                          class="text-muted text-center mt-4"
                        >
                          Select a log to view transcript.
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div
          class="modal fade"
          :class="{ show: showCreateModal || showEditModal }"
          :style="{ display: (showCreateModal || showEditModal) ? 'block' : 'none' }"
          tabindex="-1"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">
                  {{ showEditModal ? 'Edit Client' : 'Create New Client' }}
                </h5>

                <div class="ms-auto d-flex align-items-center gap-3">
                  <button
                    type="submit"
                    form="clientForm"
                    class="btn btn-sm btn-edit"
                    :disabled="saving"
                  >
                    {{ saving ? 'SAVING...' : 'SAVE' }}
                  </button>

                  <button
                    type="button"
                    class="btn-close m-0"
                    @click="closeModal"
                  ></button>
                </div>
              </div>
              <div class="modal-body">
                <!-- Full-screen System Prompt Editor -->
                <div
                  v-if="systemPromptExpanded"
                  class="system-prompt-fullscreen"
                >
                  <div
                    class="d-flex justify-content-between align-items-center mb-3"
                  >
                    <h5 class="mb-0">System Prompt Editor</h5>
                    <button
                      type="button"
                      class="btn btn-outline-secondary btn-sm"
                      @click="toggleSystemPromptExpansion"
                    >
                      ‚Üê Back to Form
                    </button>
                  </div>
                  <textarea
                    v-model="clientForm.system_prompt"
                    class="form-control system-prompt-fullscreen-textarea"
                    rows="25"
                    placeholder="Enter your system prompt here..."
                  ></textarea>
                </div>

                <!-- Normal Form View -->
                <form v-else id="clientForm" @submit.prevent="saveClient">
                  <ul class="nav nav-tabs mb-3">
                    <li class="nav-item">
                      <a
                        class="nav-link"
                        :class="{ active: activeClientTab === 'basic' }"
                        href="#"
                        @click.prevent="activeClientTab = 'basic'"
                        >Basic Info</a
                      >
                    </li>
                    <li class="nav-item">
                      <a
                        class="nav-link"
                        :class="{ active: activeClientTab === 'ai' }"
                        href="#"
                        @click.prevent="activeClientTab = 'ai'"
                        >AI Config</a
                      >
                    </li>
                    <li class="nav-item">
                      <a
                        class="nav-link"
                        :class="{ active: activeClientTab === 'prompting' }"
                        href="#"
                        @click.prevent="activeClientTab = 'prompting'"
                        >Prompting</a
                      >
                    </li>
                    <li class="nav-item">
                      <a
                        class="nav-link"
                        :class="{ active: activeClientTab === 'tools' }"
                        href="#"
                        @click.prevent="activeClientTab = 'tools'"
                        >Tools</a
                      >
                    </li>
                  </ul>

                  <div class="tab-content">
                    <div v-if="activeClientTab === 'basic'">
                      <div class="row">
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label class="form-label">Name *</label>
                            <input
                              v-model="clientForm.name"
                              type="text"
                              class="form-control"
                              required
                            />
                          </div>
                          <div class="mb-3">
                            <label class="form-label">Cell Phone</label>
                            <input
                              v-model="clientForm.cell"
                              type="text"
                              class="form-control"
                              disabled
                              placeholder="Pending Provisioning..."
                            />
                            <div class="form-text text-muted">
                              Phone numbers are claimed after initial setup and
                              payment.
                            </div>
                          </div>
                          <div class="mb-3">
                            <label class="form-label">Calendar ID</label>
                            <input
                              v-model="clientForm.calendar_id"
                              type="text"
                              class="form-control"
                            />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label class="form-label">Business Timezone</label>
                            <select
                              v-model="clientForm.business_timezone"
                              class="form-select"
                            >
                              <option value="America/Los_Angeles">
                                America/Los_Angeles
                              </option>
                              <option value="America/New_York">
                                America/New_York
                              </option>
                              <option value="America/Chicago">
                                America/Chicago
                              </option>
                              <option value="America/Denver">
                                America/Denver
                              </option>
                            </select>
                          </div>
                          <div class="row">
                            <div class="col-md-6">
                              <div class="mb-3">
                                <label class="form-label">Start Hour</label>
                                <select
                                  v-model.number="clientForm.business_start_hour"
                                  class="form-select"
                                >
                                  <option
                                    v-for="h in 24"
                                    :key="h-1"
                                    :value="h-1"
                                  >
                                    {{ formatHour(h-1) }}
                                  </option>
                                </select>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="mb-3">
                                <label class="form-label">End Hour</label>
                                <select
                                  v-model.number="clientForm.business_end_hour"
                                  class="form-select"
                                >
                                  <option
                                    v-for="h in 24"
                                    :key="h-1"
                                    :value="h-1"
                                  >
                                    {{ formatHour(h-1) }}
                                  </option>
                                </select>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div v-if="activeClientTab === 'ai'">
                      <div class="row">
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label class="form-label">LLM Model</label>
                            <select
                              v-model="clientForm.llm_model"
                              class="form-select"
                            >
                              <option value="openai/gpt-4o-mini">
                                openai/gpt-4o-mini
                              </option>
                              <option value="anthropic/claude-3-haiku">
                                anthropic/claude-3-haiku
                              </option>
                              <option value="google/gemini-flash-1.5">
                                google/gemini-flash-1.5
                              </option>
                              <option value="x-ai/grok-4-fast">
                                x-ai/grok-4-fast
                              </option>
                            </select>
                          </div>
                          <div class="mb-3">
                            <label class="form-label">STT Model</label>
                            <select
                              v-model="clientForm.stt_model"
                              class="form-select"
                            >
                              <option value="nova-2-phonecall">
                                Deepgram Nova 2 Phonecall
                              </option>
                              <option value="nova-2-conversationalai">
                                Deepgram Nova 2 Conversational AI
                              </option>
                              <option value="nova-2-medical">
                                Deepgram Nova 2 Medical
                              </option>
                              <option value="nova-2-automotive">
                                Deepgram Nova 2 Automotive
                              </option>
                            </select>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label class="form-label">TTS Model</label>
                            <select
                              v-model="clientForm.tts_model"
                              class="form-select"
                            >
                              <option value="eleven_flash_v2_5">
                                ElevenLabs Flash v2.5
                              </option>
                              <option value="eleven_flash_v2">
                                ElevenLabs Flash v2
                              </option>
                              <option value="eleven_turbo_v2_5">
                                ElevenLabs Turbo v2.5
                              </option>
                              <option value="eleven_turbo_v2">
                                ElevenLabs Turbo v2
                              </option>
                            </select>
                          </div>
                          <div class="mb-3">
                            <label class="form-label">TTS Voice ID</label>

                            <div class="input-group">
                              <select
                                class="form-select"
                                style="max-width: 160px; border-right: none"
                                @change="clientForm.tts_voice_id = $event.target.value"
                              >
                                <option value="" disabled selected>
                                  Quick Fill...
                                </option>
                                <option
                                  v-for="voice in voicePresets"
                                  :key="voice.id"
                                  :value="voice.id"
                                >
                                  {{ voice.name }}
                                </option>
                              </select>

                              <input
                                v-model="clientForm.tts_voice_id"
                                type="text"
                                class="form-control"
                                placeholder="Paste ID here or select preset..."
                              />
                            </div>
                            <div class="form-text text-muted">
                              Select a preset to auto-fill, or paste a custom
                              Clone ID from ElevenLabs.
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div v-if="activeClientTab === 'prompting'">
                      <div class="mb-3">
                        <label class="form-label">Use Template</label>
                        <select
                          v-model="selectedTemplate"
                          @change="applyTemplate"
                          class="form-select template-selector w-100"
                          style="max-width: none"
                        >
                          <option value="">Select Template</option>
                          <option
                            v-for="(template, key) in templates"
                            :key="key"
                            :value="key"
                          >
                            {{ template.name }}
                          </option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Initial Greeting</label>
                        <textarea
                          v-model="clientForm.initial_greeting"
                          class="form-control"
                          rows="2"
                        ></textarea>
                      </div>
                      <div class="mb-3">
                        <label
                          class="form-label d-flex justify-content-between align-items-center"
                        >
                          System Prompt
                          <button
                            type="button"
                            class="btn btn-sm btn-outline-secondary"
                            @click="toggleSystemPromptExpansion"
                          >
                            Expand to Full Screen
                          </button>
                        </label>
                        <textarea
                          v-model="clientForm.system_prompt"
                          class="form-control"
                          rows="12"
                        ></textarea>
                      </div>
                    </div>

                    <div v-if="activeClientTab === 'tools'">
                      <div
                        class="p-4 border rounded"
                        style="
                          background: var(--theme-bg-dark);
                          border-color: var(--theme-bg-mid) !important;
                        "
                      >
                        <label
                          class="form-label mb-4 text-warning"
                          style="letter-spacing: 2px"
                          >>> ACTIVE CAPABILITIES</label
                        >

                        <div class="form-check mb-3">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            v-model="clientForm.enable_scheduling"
                            id="bundle_scheduling"
                          />
                          <label
                            class="form-check-label fw-bold"
                            for="bundle_scheduling"
                            >Enable Scheduling</label
                          >
                          <div class="text-muted small ms-4 mt-1">
                            Allows the agent to check availability, book,
                            reschedule, and cancel appointments via Google
                            Calendar.
                          </div>
                        </div>

                        <hr class="border-secondary opacity-25 my-3" />

                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            v-model="clientForm.enable_contact_memory"
                            id="bundle_contact"
                          />
                          <label
                            class="form-check-label fw-bold"
                            for="bundle_contact"
                            >Contact Memory</label
                          >
                          <div class="text-muted small ms-4 mt-1">
                            Allows the agent to learn and save the caller's name
                            for future personalized greetings.
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Top Up Modal -->
        <div
          class="modal fade"
          :class="{ show: showTopUpModal }"
          :style="{ display: showTopUpModal ? 'block' : 'none' }"
          tabindex="-1"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div
                class="modal-header border-bottom border-secondary border-opacity-25"
              >
                <h5 class="modal-title text-success">
                  <i class="bi bi-cash-coin me-2"></i> Add Funds
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  @click="closeTopUpModal"
                ></button>
              </div>
              <div class="modal-body p-4">
                <div v-if="selectedTopUpClient" class="text-center mb-4">
                  <h6 class="text-muted">Refueling Agent:</h6>
                  <h4 class="text-fg">{{ selectedTopUpClient.name }}</h4>
                  <div
                    class="badge bg-dark border border-secondary text-secondary mt-1"
                  >
                    Current Balance: {{
                    formatDuration(selectedTopUpClient.balance_seconds || 0) }}
                  </div>
                </div>

                <div class="row g-4">
                  <!-- Refuel 50 -->
                  <div class="col-md-4">
                    <div
                      class="card h-100 border-secondary border-opacity-25 bg-dark"
                    >
                      <div
                        class="card-header text-center bg-transparent border-0 pt-4"
                      >
                        <h5 class="text-muted">REFUEL 50</h5>
                        <h2 class="display-6 fw-bold text-fg">$10</h2>
                        <span class="text-muted small">50 Minutes</span>
                      </div>
                      <div class="card-body text-center">
                        <ul class="list-unstyled text-muted small">
                          <li>$0.20 / minute</li>
                          <li>Quick Top-Up</li>
                        </ul>
                      </div>
                      <div class="card-footer bg-transparent border-0 pb-4">
                        <button
                          @click="initiateCheckout('topup_small')"
                          class="btn btn-outline-secondary w-100"
                        >
                          Select
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Refuel 100 -->
                  <div class="col-md-4">
                    <div
                      class="card h-100 border-info border-opacity-50"
                      style="background: rgba(13, 202, 240, 0.1)"
                    >
                      <div
                        class="card-header text-center bg-transparent border-0 pt-4"
                      >
                        <h5 class="text-info">REFUEL 100</h5>
                        <h2 class="display-6 fw-bold text-white">$20</h2>
                        <span class="text-info small fw-bold">100 Minutes</span>
                      </div>
                      <div class="card-body text-center">
                        <ul class="list-unstyled text-white small opacity-75">
                          <li>$0.20 / minute</li>
                          <li>Standard Pack</li>
                        </ul>
                      </div>
                      <div class="card-footer bg-transparent border-0 pb-4">
                        <button
                          @click="initiateCheckout('topup_medium')"
                          class="btn btn-info w-100"
                        >
                          Select
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Refuel 500 -->
                  <div class="col-md-4">
                    <div
                      class="card h-100 border-warning border-opacity-50 bg-dark position-relative overflow-hidden"
                    >
                      <div
                        class="position-absolute top-0 end-0 bg-warning text-dark px-3 py-1 small fw-bold"
                        style="border-bottom-left-radius: 8px"
                      >
                        BEST VALUE
                      </div>
                      <div
                        class="card-header text-center bg-transparent border-0 pt-4"
                      >
                        <h5 class="text-warning">REFUEL 500</h5>
                        <h2 class="display-6 fw-bold text-fg">$50</h2>
                        <span class="text-warning small fw-bold"
                          >500 Minutes</span
                        >
                      </div>
                      <div class="card-body text-center">
                        <ul class="list-unstyled text-muted small">
                          <li>$0.10 / minute</li>
                          <li>Power User Deal</li>
                        </ul>
                      </div>
                      <div class="card-footer bg-transparent border-0 pb-4">
                        <button
                          @click="initiateCheckout('topup_large')"
                          class="btn btn-outline-warning w-100"
                        >
                          Select
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="text-center mt-4">
                  <small class="text-muted">
                    <i class="bi bi-shield-lock-fill me-1"></i>
                    Secure payment processing via Stripe
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Modal -->
        <div
          class="modal fade"
          :class="{ show: showSettingsModal }"
          :style="{ display: showSettingsModal ? 'block' : 'none' }"
          tabindex="-1"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Settings</h5>

                <div class="ms-auto d-flex align-items-center">
                  <button
                    type="button"
                    class="btn-close m-0"
                    @click="closeSettingsModal"
                  ></button>
                </div>
              </div>
              <div class="modal-body">
                <div class="mb-4">
                  <label class="form-label text-blue mb-2">>> APPEARANCE</label>
                  <div
                    class="p-3 border rounded"
                    style="
                      border-color: var(--theme-bg-mid) !important;
                      background: var(--theme-bg-dark);
                    "
                  >
                    <label class="form-label small text-muted mb-1"
                      >THEME PRESET</label
                    >
                    <select
                      v-model="currentTheme"
                      @change="applyTheme(currentTheme)"
                      class="form-select form-select-sm"
                    >
                      <option
                        v-for="theme in themes"
                        :key="theme.key"
                        :value="theme.key"
                      >
                        {{ theme.name }}
                      </option>
                    </select>
                  </div>
                </div>

                <div class="mb-4">
                  <label class="form-label text-blue mb-2"
                    >>> DATA OPERATIONS</label
                  >
                  <div
                    class="p-3 border rounded"
                    style="
                      border-color: var(--theme-bg-mid) !important;
                      background: var(--theme-bg-dark);
                    "
                  >
                    <div
                      class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom"
                      style="border-color: var(--theme-bg-mid) !important"
                    >
                      <div>
                        <span
                          class="text-fg d-block"
                          style="font-size: 0.85rem; letter-spacing: 1px"
                          >EXPORT DATABASE</span
                        >
                        <small class="text-muted" style="font-size: 0.7rem"
                          >Download full client list as JSON.</small
                        >
                      </div>
                      <button
                        @click="exportClients"
                        class="btn btn-sm btn-outline-info d-flex align-items-center gap-2"
                      >
                        <i class="bi bi-download"></i> DOWNLOAD
                      </button>
                    </div>

                    <div>
                      <span
                        class="text-fg d-block mb-2"
                        style="font-size: 0.85rem; letter-spacing: 1px"
                        >IMPORT CLIENTS (APPEND)</span
                      >
                      <div class="d-flex gap-2 align-items-center">
                        <input
                          type="file"
                          accept=".json"
                          @change="handleFileSelect"
                          class="form-control form-control-sm"
                          style="background: transparent"
                        />
                        <button
                          @click="executeImport"
                          class="btn btn-sm btn-outline-success d-flex align-items-center gap-2"
                          :disabled="!importFile"
                        >
                          <i class="bi bi-upload"></i> UPLOAD
                        </button>
                      </div>
                      <div class="mt-2 text-muted" style="font-size: 0.65rem">
                        * Skips existing IDs. Merges new data records only.
                      </div>
                    </div>
                  </div>
                </div>

                <div class="mb-4">
                  <label class="form-label text-blue mb-2"
                    >>> SYSTEM STATUS</label
                  >
                  <div
                    class="p-3 border rounded"
                    style="
                      border-color: var(--theme-bg-mid) !important;
                      background: var(--theme-bg-dark);
                    "
                  >
                    <div
                      class="d-flex justify-content-between align-items-center"
                    >
                      <div>
                        <span
                          class="text-danger d-block"
                          style="font-size: 0.85rem; letter-spacing: 1px"
                          >CLEAR SESSION</span
                        >
                        <small class="text-muted" style="font-size: 0.7rem"
                          >Logout and clear local tokens.</small
                        >
                      </div>
                      <button
                        class="btn btn-sm btn-outline-danger d-flex align-items-center gap-2"
                        onclick="
                          localStorage.clear();
                          location.reload();
                        "
                      >
                        <i class="bi bi-radioactive"></i> RESET
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button
        v-if="activeTab === 'clients'"
        @click="showCreateModal = true"
        class="btn btn-fab"
        title="Create New Client"
      >
        +
      </button>

      <div id="auditLogModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">SYSTEM ACTIVITY LOG</h5>
              <button
                type="button"
                class="btn-close"
                @click="closeAuditLog"
              ></button>
            </div>
            <div class="modal-body p-0">
              <div class="terminal-console">
                <div v-if="auditLogs.length === 0" class="text-muted">
                  System silent. No activity recorded.
                </div>
                <div v-for="log in auditLogs" :key="log.id" class="log-entry">
                  <span class="log-timestamp"
                    >[{{ formatTimestamp(log.timestamp) }}]</span
                  >
                  <span
                    :class="log.type === 'create' ? 'text-success' : log.type === 'update' ? 'text-warning' : 'text-danger'"
                  >
                    [{{ log.type.toUpperCase() }}]
                  </span>
                  <span class="text-fg"> {{ log.action }}</span>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline-secondary"
                @click="closeAuditLog"
              >
                CLOSE
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="app.js"></script>
  </body>
</html>
